<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Norway Destinations - Interactive Map</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
  /* Primitive Color Tokens */
  --color-white: rgba(255, 255, 255, 1);
  --color-black: rgba(0, 0, 0, 1);
  --color-cream-50: rgba(252, 252, 249, 1);
  --color-cream-100: rgba(255, 255, 253, 1);
  --color-gray-200: rgba(245, 245, 245, 1);
  --color-gray-300: rgba(167, 169, 169, 1);
  --color-gray-400: rgba(119, 124, 124, 1);
  --color-slate-500: rgba(98, 108, 113, 1);
  --color-brown-600: rgba(94, 82, 64, 1);
  --color-charcoal-700: rgba(31, 33, 33, 1);
  --color-charcoal-800: rgba(38, 40, 40, 1);
  --color-slate-900: rgba(19, 52, 59, 1);
  --color-teal-300: rgba(50, 184, 198, 1);
  --color-teal-400: rgba(45, 166, 178, 1);
  --color-teal-500: rgba(33, 128, 141, 1);
  --color-teal-600: rgba(29, 116, 128, 1);
  --color-teal-700: rgba(26, 104, 115, 1);
  --color-teal-800: rgba(41, 150, 161, 1);
  --color-red-400: rgba(255, 84, 89, 1);
  --color-red-500: rgba(192, 21, 47, 1);
  --color-orange-400: rgba(230, 129, 97, 1);
  --color-orange-500: rgba(168, 75, 47, 1);

  /* RGB versions for opacity control */
  --color-brown-600-rgb: 94, 82, 64;
  --color-teal-500-rgb: 33, 128, 141;
  --color-slate-900-rgb: 19, 52, 59;
  --color-slate-500-rgb: 98, 108, 113;
  --color-red-500-rgb: 192, 21, 47;
  --color-red-400-rgb: 255, 84, 89;
  --color-orange-500-rgb: 168, 75, 47;
  --color-orange-400-rgb: 230, 129, 97;

  /* Background color tokens (Light Mode) */
  --color-bg-1: rgba(59, 130, 246, 0.08);
  --color-bg-2: rgba(245, 158, 11, 0.08);
  --color-bg-3: rgba(34, 197, 94, 0.08);
  --color-bg-4: rgba(239, 68, 68, 0.08);
  --color-bg-5: rgba(147, 51, 234, 0.08);
  --color-bg-6: rgba(249, 115, 22, 0.08);
  --color-bg-7: rgba(236, 72, 153, 0.08);
  --color-bg-8: rgba(6, 182, 212, 0.08);

  /* Semantic Color Tokens (Light Mode) */
  --color-background: var(--color-cream-50);
  --color-surface: var(--color-cream-100);
  --color-text: var(--color-slate-900);
  --color-text-secondary: var(--color-slate-500);
  --color-primary: var(--color-teal-500);
  --color-primary-hover: var(--color-teal-600);
  --color-primary-active: var(--color-teal-700);
  --color-secondary: rgba(var(--color-brown-600-rgb), 0.12);
  --color-secondary-hover: rgba(var(--color-brown-600-rgb), 0.2);
  --color-secondary-active: rgba(var(--color-brown-600-rgb), 0.25);
  --color-border: rgba(var(--color-brown-600-rgb), 0.2);
  --color-btn-primary-text: var(--color-cream-50);
  --color-card-border: rgba(var(--color-brown-600-rgb), 0.12);
  --color-card-border-inner: rgba(var(--color-brown-600-rgb), 0.12);
  --color-error: var(--color-red-500);
  --color-success: var(--color-teal-500);
  --color-warning: var(--color-orange-500);
  --color-info: var(--color-slate-500);
  --color-focus-ring: rgba(var(--color-teal-500-rgb), 0.4);
  --color-select-caret: rgba(var(--color-slate-900-rgb), 0.8);

  /* Website-specific colors */
  --website-navy: #102632;
  --website-orange: #EA5D24;
  --website-beige: #FFEADB;
  --website-white: #FFFFFF;

  /* Typography */
  --font-family-base: "FKGroteskNeue", "Geist", "Inter", -apple-system,
    BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  --font-size-base: 14px;
  --font-size-lg: 16px;
  --font-size-xl: 18px;
  --font-size-2xl: 20px;
  --font-size-3xl: 24px;
  --font-weight-medium: 500;
  --font-weight-semibold: 550;
  --line-height-normal: 1.5;
  --line-height-tight: 1.2;

  /* Spacing */
  --space-8: 8px;
  --space-12: 12px;
  --space-16: 16px;
  --space-20: 20px;
  --space-24: 24px;
  --space-32: 32px;

  /* Border Radius */
  --radius-base: 8px;
  --radius-lg: 12px;

  /* Shadows */
  --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.04),
    0 2px 4px -1px rgba(0, 0, 0, 0.02);
  --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.04),
    0 4px 6px -2px rgba(0, 0, 0, 0.02);
}

@media (prefers-color-scheme: dark) {
  :root {
    --color-gray-400-rgb: 119, 124, 124;
    --color-teal-300-rgb: 50, 184, 198;
    --color-gray-300-rgb: 167, 169, 169;
    --color-gray-200-rgb: 245, 245, 245;

    --color-bg-1: rgba(29, 78, 216, 0.15);
    --color-bg-2: rgba(180, 83, 9, 0.15);
    --color-bg-3: rgba(21, 128, 61, 0.15);
    --color-bg-4: rgba(185, 28, 28, 0.15);
    --color-bg-5: rgba(107, 33, 168, 0.15);
    --color-bg-6: rgba(194, 65, 12, 0.15);
    --color-bg-7: rgba(190, 24, 93, 0.15);
    --color-bg-8: rgba(8, 145, 178, 0.15);

    --color-background: var(--color-charcoal-700);
    --color-surface: var(--color-charcoal-800);
    --color-text: var(--color-gray-200);
    --color-text-secondary: rgba(var(--color-gray-300-rgb), 0.7);
    --color-primary: var(--color-teal-300);
    --color-primary-hover: var(--color-teal-400);
    --color-primary-active: var(--color-teal-800);
    --color-secondary: rgba(var(--color-gray-400-rgb), 0.15);
    --color-secondary-hover: rgba(var(--color-gray-400-rgb), 0.25);
    --color-secondary-active: rgba(var(--color-gray-400-rgb), 0.3);
    --color-border: rgba(var(--color-gray-400-rgb), 0.3);
    --color-card-border: rgba(var(--color-gray-400-rgb), 0.2);
    --color-btn-primary-text: var(--color-slate-900);    
  }
}

@font-face {
  font-family: 'FKGroteskNeue';
  src: url('https://r2cdn.perplexity.ai/fonts/FKGroteskNeue.woff2')
    format('woff2');
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Inter', var(--font-family-base);
    background-color: linear-gradient(135deg, var(--color-dark-primary) 0%, var(--color-dark-secondary) 100%);
    color: var(--website-navy);
    line-height: 1.6;
    -webkit-font-smoothing: antialiased;
}

/* Section Container - Full Width with Background Map */
.destinations-section {
    position: relative;
    background-color: linear-gradient(135deg, #102632 0%, #25414E 100%);
    padding: 100px 0;
    width: 100%;
    overflow: hidden;
}

/* Full-width background map layer */
.map-background {
    position: absolute;
    top: 3rem;
    left: 9rem;
    width: 100%;
    height: 100%;    
    pointer-events: none;
}

.map-background * {
    pointer-events: none;
}

.map-background #background-map {
    width: 100%;
    height: 100%;
    background-color: linear-gradient(135deg, var(--color-dark-primary) 0%, var(--color-dark-secondary) 100%);
}

/* Allow marker interaction on background map */
.map-background .leaflet-marker-icon {
    pointer-events: auto !important;
    cursor: pointer !important;
}

.map-background .leaflet-marker-pane {
    pointer-events: auto !important;
    z-index: 600 !important;
}

.map-background .leaflet-pane {
    pointer-events: none !important;
}

.map-background .leaflet-overlay-pane {
    pointer-events: auto !important;
}

/* Content wrapper - sits on top of map background */
.section-content-wrapper {
    position: relative;
    z-index: 2;
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 60px;
}

.section-header {
    text-align: center;
    margin-bottom: 60px;
    position: relative;
    z-index: 2;
}

.section-header h1 {
    font-family: 'Playfair Display', serif;
    font-size: 48px;
    font-weight: 700;
    color: #EA5D24;
    margin-bottom: 16px;
    letter-spacing: -0.02em;
}

.section-header p {
    font-family: 'Inter', sans-serif;
    font-size: 18px;
    color: #FFEADB;
    opacity: 0.7;
    max-width: 700px;
    margin: 0 auto;
}

/* Two-column layout - floats on top of background */
.map-container {
    display: flex;
    gap: 40px;
    align-items: stretch;
    min-height: 600px;
    position: relative;
    z-index: 2;
}

/* Left panel - Information with subtle transparency */
.info-panel {
    flex: 0 0 40%;
    background-color: #102632;  
    padding: 40px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    transition: all 0.4s ease;
    position: relative; /* For close btn positioning */
    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.7);
}

.info-content {
    opacity: 1;
    transition: opacity 0.3s ease;
}

.info-content.fade-out {
    opacity: 0;
}

/* Close button - hidden by default (desktop) */
.close-btn {
    position: absolute;
    top: 15px;
    right: 15px;
    background: rgba(16, 38, 50, 0.6);
    border: none;
    color: #EA5D24;
    font-size: 28px;
    line-height: 1;
    cursor: pointer;
    display: none; /* Hidden on Desktop */
    z-index: 20;
    width: 36px;
    height: 36px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background 0.2s ease;
}

.close-btn:hover {
    background: rgba(16, 38, 50, 0.9);
}

/* We explicitly hide it on desktop via media query just to be safe if display:none wasn't enough */
@media (min-width: 481px) {
    .close-btn {
        display: none !important;
    }
}


.destination-image {
    width: 100%;
    height: 320px;
    object-fit: cover;    
    margin-bottom: 24px;
    box-shadow: 0 8px 24px rgba(16, 38, 50, 0.12);
}

.destination-name {
    font-family: 'Playfair Display', serif;
    font-size: 36px;
    font-weight: 700;
    color: #EA5D24;
    margin-bottom: 16px;
    letter-spacing: -0.01em;
}

.destination-description {
    font-family: 'Inter', sans-serif;
    font-size: 16px;
    line-height: 1.7;
    color: #FFEADB;
    opacity: 0.8;
}

.default-content {
    text-align: center;
}

.default-content .destination-name {
    margin-bottom: 20px;
}

/* Right panel - Empty space (transparent, floats on background map) */
.map-panel {
    flex: 0 0 60%;
    position: relative;
    min-height: 600px;
    pointer-events: none;
}

/* Background map styling */
.leaflet-container {
    background-color: var(--website-white);
}

/* Ensure background map allows interaction */
#background-map .leaflet-marker-pane {
    pointer-events: auto !important;
}

#background-map .leaflet-overlay-pane {
    pointer-events: auto !important;
}

/* Custom marker styles */
.custom-marker {
    background-color: var(--website-orange);
    border: 3px solid var(--website-white);
    border-radius: 50%;
    width: 20px;
    height: 20px;
    cursor: pointer !important;
    transition: all 0.3s ease;
    box-shadow: 0 2px 8px rgba(234, 93, 36, 0.4), 0 0 0 0 rgba(234, 93, 36, 0.4);
    pointer-events: auto !important;
    z-index: 1000 !important;
    position: relative;
}

.custom-marker:hover {
    background-color: var(--website-orange);
    transform: scale(1.3);
    box-shadow: 0 4px 16px rgba(234, 93, 36, 0.6), 0 0 0 8px rgba(234, 93, 36, 0.15);
}

/* Hide default popups - we use the left panel instead */
.leaflet-popup {
    display: none !important;
}

/* Remove any tile loading artifacts and ensure pure white background */
.leaflet-tile-pane {
    display: none !important;
}

/* Ensure background map base layers don't interfere */
#background-map .leaflet-tile-pane {
    pointer-events: none;
}

.leaflet-container {
    cursor: default !important;
}

/* Ensure markers are interactive on background map */
.custom-marker,
.leaflet-marker-icon {
    pointer-events: auto !important;
    cursor: pointer !important;
    z-index: 1000 !important;
}

.leaflet-marker-pane {
    pointer-events: auto !important;
}

/* Responsive adjustments */
@media (max-width: 1200px) {
    .section-content-wrapper {
        padding: 0 40px;
    }

    .destinations-section {
        padding: 80px 0;
    }

    .section-header h1 {
        font-size: 40px;
    }

    .map-container {
        gap: 30px;
    }
}

@media (max-width: 968px) {
    .section-content-wrapper {
        padding: 0 30px;
    }

    .destinations-section {
        padding: 60px 0;
    }

    .section-header h1 {
        font-size: 36px;
    }

    .section-header p {
        font-size: 16px;
    }

    .map-container {
        flex-direction: column;
        gap: 30px;
    }

    .info-panel,
    .map-panel {
        flex: 1 1 auto;
    }

    .info-panel {
        order: 2;
        padding: 30px;
    }

    .map-panel {
        order: 1;
        min-height: 500px;
    }

    .destination-image {
        height: 250px;
    }

    .destination-name {
        font-size: 32px;
    }
}

@media (max-width: 640px) {
    .section-content-wrapper {
        padding: 0 20px;
    }

    .destinations-section {
        padding: 40px 0;
    }

    .section-header {
        margin-bottom: 40px;
    }

    .section-header h1 {
        font-size: 32px;
    }

    .section-header p {
        font-size: 15px;
    }

    .info-panel {
        padding: 24px;
    }

    .destination-image {
        height: 200px;
    }

    .destination-name {
        font-size: 28px;
    }

    .destination-description {
        font-size: 15px;
    }

    .map-panel {
        min-height: 400px;
    }
}

/* NEW: Specific rules for 480px and below */
@media (max-width: 480px) {
    /* Center the info panel as a popup overlay */
    .info-panel {
        display: none; /* Hide info panel by default */
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 90%;
        max-width: 350px;
        max-height: 85vh;
        overflow-y: auto;
        background-color: #102632; /* Solid background color (Navy) */
        /* border: 1px solid rgba(234, 93, 36, 0.3); */
        z-index: 2000; /* Ensure it's above the map */
        /* border-radius: 16px; */
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.7);
        margin: 0; /* Remove any flex margin */
        padding: 40px 24px 24px 24px; /* Top padding for close button */
    }

    .info-panel.visible {
        display: flex !important; /* Added !important to override display:none and force flex */
        flex-direction: column;
        animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }
    
    .close-btn {
        display: flex !important; /* Force show on mobile */
    }

    .map-panel {
        min-height: 350px; /* Adjust map panel height */
        width: 100%;
    }

    .map-background {
        position: absolute;
        top: 7rem;
        left: -6rem;
        width: 120%;
        height: 100%;
        pointer-events: none;
    }
}

@keyframes popIn {
    0% { opacity: 0; transform: translate(-50%, -40%) scale(0.9); }
    100% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
}

/* Loading state */
.loading {
    display: flex;
    align-items: center;
    justify-content: center;
    height: 100vh;
    font-size: var(--font-size-lg);
    color: var(--color-text-secondary);
}
    </style>
</head>
<body>
    <!-- This section comes after gallery-showcase section in your website -->
    <section class="destinations-section" id="destinations-map">
        <!-- Full-width background map layer -->
        <div class="map-background">
            <div id="background-map"></div>
        </div>

        <!-- Content overlay -->
        <div class="section-content-wrapper">
            <div class="section-header">
                <h1>Discover Our Destinations</h1>
                <p>Explore the stunning landscapes and experiences across Northern Norway</p>
            </div>

            <div class="map-container">
                <!-- Left Panel: Information Display -->
                <div class="info-panel">
                    <!-- CLOSE BUTTON for Mobile -->
                    <button class="close-btn" id="close-info-panel" aria-label="Close info panel">&times;</button>
                    
                    <div class="info-content" id="info-content">
                        <div class="default-content">
                            <h2 class="destination-name">Northern Norway</h2>
                            <p class="destination-description">Explore five stunning destinations across Northern Norway. Hover over the markers on the map to discover each unique location.</p>
                        </div>
                    </div>
                </div>

                <!-- Right Panel: Empty visual space -->
                <div class="map-panel">
                    <!-- Empty space for visual balance -->
                </div>
            </div>
        </div>
    </section>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
   <script>
        // Destination data with images and descriptions - 10 total destinations
        const destinations = [
            {
                name: 'Tromsø',
                lat: 69.6496,
                lon: 18.956,
                image: 'https://pplx-res.cloudinary.com/image/upload/v1762691856/pplx_project_search_images/5c941f4198562f7fc95b42b5dd325d504d70042e.png',
                description: 'Tromsø is Norway\'s Arctic capital, famed for winter northern lights, summer midnight sun, and vibrant culture amid majestic fjords and mountains.'
            },
            {
                name: 'Lofoten Islands',
                lat: 68.5736,
                lon: 13.959,
                image: 'https://pplx-res.cloudinary.com/image/upload/v1762691856/pplx_project_search_images/cc0da763beb9a6b8e28ae3454dfcfe668197a2de.png',
                description: 'Lofoten Islands offer dramatic mountains, picturesque villages, and world-class hiking beneath the aurora and midnight sun.'
            },
            {
                name: 'Bergen',
                lat: 60.39299,
                lon: 5.32415,
                image: 'https://pplx-res.cloudinary.com/image/upload/v1760345836/pplx_project_search_images/d892358331304effc8e664a770a33efffab98753.png',
                description: 'Bergen\'s colorful waterfront, UNESCO Bryggen district, and surrounding mountains make it the gateway to Norway\'s fjords.'
            },
            {
                name: 'Geirangerfjord',
                lat: 62.50147,
                lon: 7.20549,
                image: 'https://pplx-res.cloudinary.com/image/upload/v1755454427/pplx_project_search_images/fd1eb5ad5e0f910024c94f401649b64eb119ce22.png',
                description: 'Geirangerfjord is Norway\'s most famous fjord, a UNESCO site famed for sheer cliffs, waterfalls, and breathtaking panoramas.'
            },
            {
                name: 'Sognefjord',
                lat: 61.85222,
                lon: 6.56000,
                image: 'https://pplx-res.cloudinary.com/image/upload/v1762691857/pplx_project_search_images/b5015eb921cd54214db39c3c7c6e60b7f8385da4.png',
                description: 'Sognefjord is Norway\'s longest and deepest fjord, known for serene waters, green valleys, and historic villages nestled among spectacular nature.'
            },
            {
                name: 'Bodø',
                lat: 68.57,
                lon: 14.405,
                image: 'https://pplx-res.cloudinary.com/image/upload/v1762704220/pplx_project_search_images/1f3a14d342f36452d091ad7bf22e6599cc91a6bf.png',
                description: 'Bodø is a vibrant Arctic gateway city, famous for the powerful Saltstraumen maelstrom and stunning coastal landscapes.'
            },
            {
                name: 'Senja',
                lat: 70.40,
                lon: 16.800,
                image: 'https://pplx-res.cloudinary.com/image/upload/v1762704219/pplx_project_search_images/eb8dbdcb8b6857aee619b1557d5177199d741306.png',
                description: 'Senja Island offers dramatic peaks, rugged coastlines, and pristine wilderness, perfect for photographers and nature lovers.'
            },
            {
                name: 'North Cape',
                lat: 72.312,
                lon: 25.545,
                image: 'https://pplx-res.cloudinary.com/image/upload/v1762704219/pplx_project_search_images/042531000635e943e48fb28ebff2fd7924160e69.png',
                description: 'North Cape is the northernmost point of continental Europe, an iconic destination with panoramic Arctic views and the famous globe monument.'
            },
            {
                name: 'Alta',
                lat: 71.200,
                lon: 23.271,
                image: 'https://pplx-res.cloudinary.com/image/upload/v1762704219/pplx_project_search_images/3f839fb08aea4ca565b80a83307a1fac64466570.png',
                description: 'Alta is Norway\'s northern lights capital, offering spectacular aurora displays and serene Arctic landscape experiences.'
            },
            {
                name: 'Lyngen',
                lat: 71.34,
                lon: 20.25,
                image: 'https://pplx-res.cloudinary.com/image/upload/v1762704219/pplx_project_search_images/fb02a001c3d89ff1462caee6672fb0b4de87c0a1.png',
                description: 'Lyngen Alps feature majestic snow-covered peaks, pristine fjords, and world-class hiking and skiing opportunities in the Arctic.'
            }
        ];

        // Get the default zoom level
        const defaultZoom = 5;
        const mobileZoom = 4;

        // Initialize the BACKGROUND map - full width, with markers
        const backgroundMap = L.map('background-map', {
            center: [65.0, 12.0],
            zoom: defaultZoom, // Start with default zoom
            zoomControl: false,
            dragging: false,
            touchZoom: false,
            scrollWheelZoom: false,
            doubleClickZoom: false,
            boxZoom: false,
            keyboard: false,
            tap: true, // MODIFIED: Set to true to detect map clicks
            preferCanvas: true
        });

        // Load high-resolution Norway GeoJSON data from Natural Earth
        // Using medium scale (1:10m) for detailed coastline with fjords
   fetch('https://raw.githubusercontent.com/nvkelso/natural-earth-vector/master/geojson/ne_10m_admin_0_countries.geojson')
    .then(response => response.json())
    .then(data => {
        // Filter for Norway
        const norwayFeature = data.features.find(feature => 
            feature.properties.NAME === 'Norway' || 
            feature.properties.ADMIN === 'Norway' ||
            feature.properties.ISO_A3 === 'NOR'
        );

        if (norwayFeature) {
            const geometry = norwayFeature.geometry;
            
            if (geometry.type === 'MultiPolygon') {
                // Find the largest polygon (mainland)
                let largestPolygon = null;
                let maxArea = 0;
                let mainlandBounds = null;
                
                geometry.coordinates.forEach(polygon => {
                    const area = polygon[0].length;
                    if (area > maxArea) {
                        maxArea = area;
                        largestPolygon = polygon;
                        // Calculate rough center/bounds of mainland
                        const lats = polygon[0].map(coord => coord[1]);
                        const lons = polygon[0].map(coord => coord[0]);
                        mainlandBounds = {
                            minLat: Math.min(...lats),
                            maxLat: Math.max(...lats),
                            minLon: Math.min(...lons),
                            maxLon: Math.max(...lons),
                            centerLat: (Math.min(...lats) + Math.max(...lats)) / 2,
                            centerLon: (Math.min(...lons) + Math.max(...lons)) / 2
                        };
                    }
                });
                
                // Filter polygons: keep mainland + nearby islands
                const filteredPolygons = geometry.coordinates.filter(polygon => {
                    // Get center of this polygon
                    const lats = polygon[0].map(coord => coord[1]);
                    const lons = polygon[0].map(coord => coord[0]);
                    const centerLat = (Math.min(...lats) + Math.max(...lats)) / 2;
                    const centerLon = (Math.min(...lons) + Math.max(...lons)) / 2;
                    
                    // Calculate distance from mainland center
                    const latDiff = Math.abs(centerLat - mainlandBounds.centerLat);
                    const lonDiff = Math.abs(centerLon - mainlandBounds.centerLon);
                    
                    // Keep if within reasonable distance (adjust threshold as needed)
                    // ~15 degrees covers coastal islands but excludes Svalbard (77°N) and Jan Mayen
                    return latDiff < 15 && lonDiff < 15;
                });
                
                // Create feature with mainland + nearby islands
                const mainlandFeature = {
                    type: 'Feature',
                    properties: norwayFeature.properties,
                    geometry: {
                        type: 'MultiPolygon',
                        coordinates: filteredPolygons
                    }
                };
                
                // Add mainland + coastal islands to BACKGROUND map
                L.geoJSON(mainlandFeature, {
                    style: {
                        color: '#ffffff',
                        weight: 1.5,
                        fillColor: 'rgba(255, 234, 219, 0.05)', 
                        fillOpacity: 1,
                        opacity: 0.8,
                        lineJoin: 'round',
                        lineCap: 'round'
                    }
                }).addTo(backgroundMap);
            }
        }
    })
    .catch(error => console.error('Error loading Norway border:', error));



        // Fallback function to load Norway data from alternative source
        function loadFallbackNorwayData() {
        }

        // Custom marker icon
        const customIcon = L.divIcon({
            className: 'custom-marker',
            iconSize: [24, 24],
            iconAnchor: [12, 12],
            popupAnchor: [0, -12]
        });

        // Get info panel elements
        const infoContent = document.getElementById('info-content');
        const infoPanel = document.querySelector('.info-panel');
        const closeInfoPanelBtn = document.getElementById('close-info-panel'); // New Button
        let currentMarker = null;

        // Function to toggle z-index between map background and info panel
        function toggleZIndex(showPanel) {
        const mapBackground = document.querySelector('.map-background');
        const mapPanel = document.querySelector('.map-panel');
    
            if (showPanel) {
            mapBackground.style.zIndex = '1';
            mapPanel.style.zIndex = '1000';
            console.log('Z-index switched: Panel on top');
            } 
            
            else {
            mapBackground.style.zIndex = '1000';
            mapPanel.style.zIndex = '1';
            console.log('Z-index switched: Map on top');
            }
        }

        // Function to update info panel
        function updateInfoPanel(destination) {
            // Fade out
            infoContent.classList.add('fade-out');

            setTimeout(() => {
                // Update content
                if (destination) {
                    infoContent.innerHTML = `
                        <img src="${destination.image}" alt="${destination.name}" class="destination-image">
                        <h2 class="destination-name">${destination.name}</h2>
                        <p class="destination-description">${destination.description}</p>
                    `;
                } else {
                    // Reset to default
                    infoContent.innerHTML = `
                        <div class="default-content">
                            <h2 class="destination-name">Northern Norway</h2>
                            <p class="destination-description">Explore five stunning destinations across Northern Norway. Hover over the markers on the map to discover each unique location.</p>
                        </div>
                    `;
                }

                // Fade in
                infoContent.classList.remove('fade-out');
            }, 300);
        }

        // Add markers for each destination to the BACKGROUND map
        destinations.forEach(destination => {
            const marker = L.marker([destination.lat, destination.lon], {
                icon: customIcon,
                interactive: true,
                bubblingMouseEvents: false // IMPORTANT: Changed to false to prevent map click closing
            }).addTo(backgroundMap);

            // Store destination data with marker
            marker.destinationData = destination;

            // Get the marker element and ensure it's interactive
            const markerElement = marker.getElement();
            if (markerElement) {
                markerElement.style.pointerEvents = 'auto';
                markerElement.style.cursor = 'pointer';
                markerElement.style.zIndex = '1000';
            }

            // Update info panel on hover
            marker.on('mouseover', function(e) {
                // MODIFIED: Only run hover effect on larger screens
                if (window.innerWidth <= 480) return;

                console.log('Marker hover:', destination.name);
                currentMarker = this;
                updateInfoPanel(destination);
                e.originalEvent.stopPropagation();
            });

            // Also update on click (for mobile)
            marker.on('click', function(e) {
                console.log('Marker click:', destination.name);
                currentMarker = this;
                updateInfoPanel(destination);
                
                // ADDED: Show the info panel on mobile
                if (window.innerWidth <= 480) {
                    infoPanel.classList.add('visible');
                    toggleZIndex(true);
                }
                
                e.originalEvent.stopPropagation();
            });

            // Add mouseenter event as backup
            marker.on('mouseenter', function() {
                // MODIFIED: Only run hover effect on larger screens
                if (window.innerWidth <= 480) return;

                console.log('Marker mouseenter:', destination.name);
                currentMarker = this;
                updateInfoPanel(destination);
            });

            // Keep info displayed on mouseout - removed auto-reset for better UX
        });

        // ADDED: Close button logic
        if (closeInfoPanelBtn) {
            closeInfoPanelBtn.addEventListener('click', function(e) {
                e.stopPropagation(); // Prevent click from bubbling to map
                infoPanel.classList.remove('visible');
                toggleZIndex(false);
            });
        }

        // ADDED: Click on map to hide info panel on mobile
        backgroundMap.on('click', function() {
            if (window.innerWidth <= 480) {
                infoPanel.classList.remove('visible');
                toggleZIndex(false);
            }
        });


        // ADDED: Function to adjust map zoom based on screen size
        function adjustMapZoom() {
            if (window.innerWidth <= 480) {
                backgroundMap.setZoom(mobileZoom);
            } else {
                backgroundMap.setZoom(defaultZoom);
            }
            backgroundMap.invalidateSize(); // Ensure map resizes correctly
        }

        // Adjust map on window resize
        window.addEventListener('resize', () => {
            adjustMapZoom(); // MODIFIED: Call new zoom function
        });

        // ADDED: Call adjustMapZoom on initial load
        adjustMapZoom();

    </script>
</body>
</html>